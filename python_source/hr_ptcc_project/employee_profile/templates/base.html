<!DOCTYPE html>
{# HTML5 declaration #}
<html>
    {# Make modifiable head elements #}
    <head>
        {% load static %}
        <title>{% block title %}PTCC HR{% endblock title %}</title>
        {% block head_favicon %}
            <link rel="icon" type="image/jpg"
                  href="{% static 'polls/images/image1.jpg' %}">
        {% endblock head_favicon %}
        {% block head_meta %}
            {% block head_meta_charset %}
                <meta http-equiv="Content-Type"
                      content="text/html; charset=utf-8" />
            {% endblock head_meta_charset %}
            {% block head_meta_contentlanguage %}
                <meta http-equiv="Content-Language" value="en-US" />
            {% endblock head_meta_contentlanguage %}
            {% block head_meta_viewport %}
                <meta name="viewport"
                      content="width=device-width, initial-scale=1.0">
            {% endblock head_meta_viewport %}
        {% endblock head_meta %}
        {% block head_css %}
            {% block head_css_site %}
                <link rel="stylesheet"
                      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
                      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
                      crossorigin="anonymous">
            {% endblock head_css_site %}
            {% block head_css_section %}
            {% endblock head_css_section %}
            {% block head_css_page %}{% endblock head_css_page %}
        {% endblock head_css %}
        <link rel="stylesheet" type="text/css" href="{% static 'employee_profile/style.css' %}">
    </head>
    <body>
    {# modal side bar #}
    <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="uploadModalLabel">Uploade File</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <div id="upload_label"></div>
                <form id="upload_form" action="{% url 'upload_view' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input id="file" type="file" name="file">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cancel_button">Cancel</button>
                <button type="submit" form="upload_form" class="btn btn-primary" id="upload_button">Upload</button>
            </div>
        </div>
        </div>
    </div>
    <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title info-modal-title" id="infoModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body info-modal-body">
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="info_button_close" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="info_button_ok" hidden="true">Generate</button>
                </div>
            </div>
        </div>
    </div>
    {# Navigation Menu #}
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="{% url 'employee_profile:index' %}">PTCC</a>
                <button class="navbar-toggler" type="button"
                        data-toggle="collapse" data-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">SIGN OUT</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    {# The Document Body #}
    <div id="site-wrapper">
        <div class="wrapper">
            <!-- Sidebar -->
            <nav id="sidebar">
                <div class="sidebar-header">
                    <a href="{% url 'employee_profile:index' %}"><h3>LEAVE REGISTRY</h3></a>
                </div>

                <ul class="list-unstyled components">
                   <li>
                       <a href="#uploadSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">UPLOAD FILES</a>
                        <ul class="collapse list-unstyled" id="uploadSubmenu">
                            <li>
                                <a class="sidebar_button" id="upload_csv">Upload a CSV File</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#generateSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">GENERATE</a>
                         <ul class="collapse list-unstyled" id="generateSubmenu">
                             <li>
                                 <a class="generate_sidebar_button" id="generate_all">Generate all</a>
                             </li>
                             <li>
                                <a class="generate_sidebar_button" id="generate_selected">Generate selected</a>
                            </li>
                         </ul>
                     </li>
                </ul>
            </nav>
            {% block content %}
                if you see this, something is wrong!
            {% endblock content %}
        </div>
    </div>
    {# The Footer #}
    <div class="footer">
        <div class="container">
            <p>Copyright CRM Easy</p>
        </div>
    </div>
    </body>
    {# Set of blocks that can be used to display JavaScript files #}
    {% block footer_javascript %}
        {% block footer_javascript_site %}
            <script
                src="https://code.jquery.com/jquery-3.5.1.min.js"
                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
                crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
                integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
                crossorigin="anonymous"></script>
        {% endblock footer_javascript_site %}
        {% block custom_js %}{% endblock custom_js %}
        {% block footer_javascript_section %}
            <script type="text/javascript">
                $(document).ready(function(e) {
                    $("#generate_all").on("click", function() {
                        $("#infoModal").modal();
                        $(".info-modal-title").html("Generate All Employees");
                        html_string = "<h6>These are the employees that will generate Leave Registry: </h6>";
                        $.each($('input.form-check-input'), function() {
                            employee_name = $(this).data("empname");
                            html_string += "<h6>*<strong>"+ employee_name + "</strong></h6>"
                        });
                        $(".info-modal-body").html(html_string);

                        $("input.form-check-input").prop("checked", true);
                        $("#check_all_employee").prop("checked", true);
                        $("#info_button_ok").attr("hidden", false);
                    });

                    $("#check_all_employee").click(function() {
                        if($(this).prop("checked")) {
                            $("input.form-check-input").prop("checked", true);
                        } else {
                            $("input.form-check-input").prop("checked", false);
                        }
                    });

                    $(document).on("click", ".sidebar_button", function() {
                        $("#uploadModal").modal();
                        id = $(this).attr("id");
                        $("#upload_label").html("<h6>Please upload CSV File in either of the following:</h6>" +
                                                 "<h6>1. employee.csv</h6>" +
                                                 "<h6>2. leaves.csv</h6>" +
                                                 "<h6>3. offenses.csv</h6>" +
                                                 "<h6>4. earned_leaves.csv</h6>"+
                                                 "<h6>5. timesheet.csv</h6>");

                        $("#uploadModalLabel").html("Upload CSV File");
                    });

                    $("#info_button_close").on("click", function() {
                        location.reload();
                    });

                    $("#upload_form").submit(function(e) {
                        console.log("helooo");
                        e.preventDefault();
                        var formData = new FormData($(this)[0]);
                        var url = "{% url 'upload_view' %}";
                        $.ajax({
                            url:url,
                            type: "POST",
                            data: formData,
                            async: false,
                            cache: false,
                            contentType: false,
                            enctype: "multipart/form-data",
                            processData: false,
                        })
                        .done(function(response) {
                            $(".info-modal-title").html(response.head);
                            $(".info-modal-body").html(response.body);
                            $("#infoModal").modal();
                            $("#uploadModal").modal('hide');
                        })
                        .fail(function(xhr, status, error){
                            $(".info-modal-title").html("Failed");
                            $(".info-modal-body").html("Failed to save data! details: " + (xhr.responseText).split(".")[0]);
                            $("#infoModal").modal();
                        });
                    });
                });
            </script>
        {% endblock footer_javascript_section %}
        {% block footer_javascript_page %}{% endblock footer_javascript_page %}
    {% endblock footer_javascript %}
    <script src="{% static 'employee_profile/drop_down.js' %}"></script>
</html>